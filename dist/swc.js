/*! For license information please see swc.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SWC=e():t.SWC=e()}(this,(()=>(()=>{var t={708:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function n(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var o=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxMessages=e.maxMessages||10,this.systemPrompt=e.systemPrompt||"You are a helpful assistant.",this.contextWindow=[],this.totalTokensEstimate=0,this.maxTokens=e.maxTokens||2e3,this.debug=e.debug||!1},e=[{key:"addMessage",value:function(t,e){if(t&&e){var r={role:t,content:e,timestamp:(new Date).toISOString(),tokens:this._estimateTokens(e)};this.contextWindow.push(r),this.totalTokensEstimate+=r.tokens,this.debug&&(console.log("[ContextManager] Added ".concat(t," message (").concat(r.tokens," tokens)")),console.log("[ContextManager] Total messages: ".concat(this.contextWindow.length,", estimated tokens: ").concat(this.totalTokensEstimate))),this._trimContext()}else console.warn("[ContextManager] Invalid message: role and content are required")}},{key:"getContext",value:function(){var t=[];return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.systemPrompt&&t.push({role:"system",content:this.systemPrompt}),this.contextWindow.forEach((function(e){t.push({role:e.role,content:e.content})})),this.debug&&console.log("[ContextManager] Returning ".concat(t.length," messages for API")),t}},{key:"getLastMessages",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return this.contextWindow.slice(-t)}},{key:"clear",value:function(){this.contextWindow=[],this.totalTokensEstimate=0,this.debug&&console.log("[ContextManager] Context cleared")}},{key:"setSystemPrompt",value:function(t){this.systemPrompt=t,this.debug&&console.log("[ContextManager] System prompt updated")}},{key:"getStats",value:function(){return{messageCount:this.contextWindow.length,estimatedTokens:this.totalTokensEstimate,maxMessages:this.maxMessages,maxTokens:this.maxTokens,systemPrompt:this.systemPrompt?this.systemPrompt.substring(0,50)+"...":null}}},{key:"_trimContext",value:function(){for(;this.contextWindow.length>this.maxMessages;){var t=this.contextWindow.shift();this.totalTokensEstimate-=t.tokens,this.debug&&console.log("[ContextManager] Removed oldest message (".concat(t.role,"), ").concat(this.contextWindow.length," remaining"))}for(;this.totalTokensEstimate>this.maxTokens&&this.contextWindow.length>2;){var e=this.contextWindow.shift();this.totalTokensEstimate-=e.tokens,this.debug&&console.log("[ContextManager] Removed message to reduce tokens (".concat(e.role,"), ").concat(this.totalTokensEstimate," tokens remaining"))}}},{key:"_estimateTokens",value:function(t){return t?Math.ceil(t.length/4):0}},{key:"summarize",value:function(){if(this.contextWindow.length<3)return"";var t=this.contextWindow.slice(0,Math.floor(this.contextWindow.length/2)).map((function(t){var e=t.content.substring(0,100);return"".concat(t.role,": ").concat(e).concat(t.content.length>100?"...":"")})).join("\n");return"Previous conversation summary:\n".concat(t)}},{key:"export",value:function(){return{version:"1.0",timestamp:(new Date).toISOString(),systemPrompt:this.systemPrompt,maxMessages:this.maxMessages,maxTokens:this.maxTokens,contextWindow:this.contextWindow.map((function(t){return{role:t.role,content:t.content,timestamp:t.timestamp}})),stats:this.getStats()}}},{key:"import",value:function(t){var e=this;try{if(!t||!t.contextWindow||!Array.isArray(t.contextWindow))throw new Error("Invalid context data format");return this.clear(),t.systemPrompt&&(this.systemPrompt=t.systemPrompt),t.maxMessages&&(this.maxMessages=t.maxMessages),t.maxTokens&&(this.maxTokens=t.maxTokens),t.contextWindow.forEach((function(t){e.addMessage(t.role,t.content)})),this.debug&&console.log("[ContextManager] Imported ".concat(this.contextWindow.length," messages")),!0}catch(t){return console.error("[ContextManager] Import failed:",t),!1}}},{key:"injectKnowledge",value:function(t){if(t){var e="".concat(this.systemPrompt,"\n\nRelevant knowledge base information:\n").concat(t);this.setSystemPrompt(e),this.debug&&console.log("[ContextManager] Knowledge injected into system prompt")}}}],e&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();t.exports&&(t.exports=o)},74:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(){"use strict";o=function(){return r};var t,r={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,r){return t[e]=r}}function d(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),s=new O(n||[]);return a(i,"_invoke",{value:T(t,r,s)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=d;var f="suspendedStart",y="suspendedYield",m="executing",g="completed",v={};function b(){}function w(){}function x(){}var k={};h(k,c,(function(){return this}));var E=Object.getPrototypeOf,C=E&&E(E(N([])));C&&C!==n&&i.call(C,c)&&(k=C);var S=x.prototype=b.prototype=Object.create(k);function I(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,r){function n(o,a,s,c){var l=p(t[o],t,a);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==e(h)&&i.call(h,"__await")?r.resolve(h.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):r.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}})}function T(e,r,n){var o=f;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=A(s,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=p(e,r,n);if("normal"===l.type){if(o=n.done?g:y,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=g,n.method="throw",n.arg=l.arg)}}}function A(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function N(r){if(r||""===r){var n=r[c];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var o=-1,a=function e(){for(;++o<r.length;)if(i.call(r,o))return e.value=r[o],e.done=!1,e;return e.value=t,e.done=!0,e};return a.next=a}}throw new TypeError(e(r)+" is not iterable")}return w.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,u,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},r.awrap=function(t){return{__await:t}},I(P.prototype),h(P.prototype,l,(function(){return this})),r.AsyncIterator=P,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new P(d(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},I(S),h(S,u,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=N,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},r}function i(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function a(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,c,"next",t)}function c(t){i(a,n,o,s,c,"throw",t)}s(void 0)}))}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function c(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var l=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiKey=e.apiKey,this.baseURL=e.baseURL||"https://openrouter.ai/api/v1",this.model=e.model||"openai/gpt-3.5-turbo",this.maxTokens=e.maxTokens||500,this.temperature=e.temperature||.7,this.siteName=e.siteName||"SenangWebs Chatbot",this.siteUrl=e.siteUrl||("undefined"!=typeof window?window.location.origin:""),this.timeout=e.timeout||3e4,this.retryAttempts=e.retryAttempts||2,this.retryDelay=e.retryDelay||1e3,this.debug=e.debug||!1,this.abortController=null,this.validateConfig()},e=[{key:"validateConfig",value:function(){if(!this.apiKey||""===this.apiKey.trim())throw new Error("OpenRouter API key is required");if(!this.baseURL||!this.baseURL.startsWith("http"))throw new Error("Invalid base URL");(this.maxTokens<1||this.maxTokens>4096)&&(console.warn("maxTokens should be between 1 and 4096, using default 500"),this.maxTokens=500),(this.temperature<0||this.temperature>2)&&(console.warn("temperature should be between 0 and 2, using default 0.7"),this.temperature=.7)}},{key:"sendMessage",value:(c=a(o().mark((function t(e,r,n,i){var a,s,c,l,u,h;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0,s=null;case 2:if(!(a<=this.retryAttempts)){t.next=35;break}return t.prev=3,this.debug&&(console.log("[OpenRouterAPI] Attempt ".concat(a+1,"/").concat(this.retryAttempts+1)),console.log("[OpenRouterAPI] Sending messages:",e)),t.next=7,this._makeRequest(e);case 7:if((c=t.sent).ok){t.next=13;break}return t.next=11,c.json().catch((function(){return{}}));case 11:throw l=t.sent,this._handleAPIError(c.status,l);case 13:return t.next=15,this._handleStreamingResponse(c,r);case 15:return u=t.sent,n&&n(u),t.abrupt("return",u);case 20:if(t.prev=20,t.t0=t.catch(3),s=t.t0,this.debug&&console.error("[OpenRouterAPI] Attempt ".concat(a+1," failed:"),t.t0),!this._shouldNotRetry(t.t0)){t.next=27;break}throw i&&i(t.t0),t.t0;case 27:if(!(++a<=this.retryAttempts)){t.next=33;break}return h=this.retryDelay*Math.pow(2,a-1),this.debug&&console.log("[OpenRouterAPI] Retrying in ".concat(h,"ms...")),t.next=33,this._sleep(h);case 33:t.next=2;break;case 35:throw i&&i(s),s;case 37:case"end":return t.stop()}}),t,this,[[3,20]])}))),function(t,e,r,n){return c.apply(this,arguments)})},{key:"_makeRequest",value:(i=a(o().mark((function t(e){var r,n,i=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.abortController=new AbortController,r=setTimeout((function(){return i.abortController.abort()}),this.timeout),t.prev=2,t.next=5,fetch("".concat(this.baseURL,"/chat/completions"),{method:"POST",headers:{Authorization:"Bearer ".concat(this.apiKey),"Content-Type":"application/json","HTTP-Referer":this.siteUrl,"X-Title":this.siteName},body:JSON.stringify({model:this.model,messages:e,max_tokens:this.maxTokens,temperature:this.temperature,stream:!0}),signal:this.abortController.signal});case 5:return n=t.sent,clearTimeout(r),t.abrupt("return",n);case 10:throw t.prev=10,t.t0=t.catch(2),clearTimeout(r),t.t0;case 14:case"end":return t.stop()}}),t,this,[[2,10]])}))),function(t){return i.apply(this,arguments)})},{key:"_handleStreamingResponse",value:(n=a(o().mark((function t(e,n){var i,a,s,c,l,u,h,d,p,f,y,m,g,v,b,w;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=e.body.getReader(),a=new TextDecoder,s="",c="",t.prev=4;case 5:return t.next=8,i.read();case 8:if(l=t.sent,u=l.done,h=l.value,!u){t.next=13;break}return t.abrupt("break",41);case 13:s+=a.decode(h,{stream:!0}),d=s.split("\n"),s=d.pop()||"",p=r(d),t.prev=17,p.s();case 19:if((f=p.n()).done){t.next=31;break}if(y=f.value,""!==(m=y.trim())){t.next=24;break}return t.abrupt("continue",29);case 24:if("data: [DONE]"!==m){t.next=26;break}return t.abrupt("continue",29);case 26:if(m.startsWith("data: ")){t.next=28;break}return t.abrupt("continue",29);case 28:try{b=JSON.parse(m.substring(6)),(w=null===(g=b.choices)||void 0===g||null===(g=g[0])||void 0===g||null===(g=g.delta)||void 0===g?void 0:g.content)&&(c+=w,n&&n({content:w,fullContent:c,done:!1})),null!==(v=b.choices)&&void 0!==v&&null!==(v=v[0])&&void 0!==v&&v.finish_reason&&this.debug&&console.log("[OpenRouterAPI] Stream finished:",b.choices[0].finish_reason)}catch(t){this.debug&&console.warn("[OpenRouterAPI] Failed to parse SSE data:",m,t)}case 29:t.next=19;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(17),p.e(t.t0);case 36:return t.prev=36,p.f(),t.finish(36);case 39:t.next=5;break;case 41:return t.abrupt("return",{content:c,model:this.model,done:!0});case 44:if(t.prev=44,t.t1=t.catch(4),"AbortError"!==t.t1.name){t.next=48;break}throw new Error("Request cancelled by user");case 48:throw t.t1;case 49:case"end":return t.stop()}}),t,this,[[4,44],[17,33,36,39]])}))),function(t,e){return n.apply(this,arguments)})},{key:"_handleAPIError",value:function(t,e){var r,n=(null===(r=e.error)||void 0===r?void 0:r.message)||"Unknown error occurred";switch(t){case 401:return new Error("Invalid API key. Please check your OpenRouter API key.");case 403:return new Error("Access forbidden. Please check your API key permissions.");case 429:var o=new Error("Rate limit exceeded. Please try again later.");return o.isRateLimit=!0,o;case 500:case 502:case 503:return new Error("OpenRouter service is temporarily unavailable. Please try again.");case 400:return new Error("Bad request: ".concat(n));default:return new Error("API error (".concat(t,"): ").concat(n))}}},{key:"_shouldNotRetry",value:function(t){return!!(t.message.includes("Invalid API key")||t.message.includes("Access forbidden")||t.message.includes("Bad request")||t.message.includes("cancelled by user"))}},{key:"cancel",value:function(){this.abortController&&(this.abortController.abort(),this.debug&&console.log("[OpenRouterAPI] Request cancelled"))}},{key:"getModelInfo",value:function(){return{model:this.model,maxTokens:this.maxTokens,temperature:this.temperature}}},{key:"_sleep",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}}],e&&s(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,c}();t.exports&&(t.exports=l)},982:(t,e,r)=>{"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,r){return t[e]=r}}function d(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),s=new O(n||[]);return a(i,"_invoke",{value:T(t,r,s)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var f="suspendedStart",y="suspendedYield",m="executing",g="completed",v={};function b(){}function w(){}function x(){}var k={};h(k,c,(function(){return this}));var E=Object.getPrototypeOf,C=E&&E(E(N([])));C&&C!==r&&i.call(C,c)&&(k=C);var S=x.prototype=b.prototype=Object.create(k);function I(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(o,a,s,c){var l=p(t[o],t,a);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==n(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return r("throw",t,s,c)}))}c(l.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function T(e,r,n){var o=f;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=A(s,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=p(e,r,n);if("normal"===l.type){if(o=n.done?g:y,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=g,n.method="throw",n.arg=l.arg)}}}function A(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},I(P.prototype),h(P.prototype,l,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new P(d(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},I(S),h(S,u,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function u(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var h,d;try{h=r(74),d=r(708)}catch(t){}"undefined"!=typeof window&&(window.OpenRouterAPI||void 0===h||(window.OpenRouterAPI=h),window.ContextManager||void 0===d||(window.ContextManager=d),h=window.OpenRouterAPI||h,d=window.ContextManager||d);var p=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.knowledgeBase=e,this.currentNode=null,this.chatHistory=[],this.botMetadata={botName:r.botName||"Bot",themeColor:r.themeColor||"#007bff",timestamp:(new Date).toISOString()},this.apiConfig=n,this.mode=(null==n?void 0:n.mode)||"keyword-only",this.streamingEnabled=!1!==(null==n?void 0:n.streaming),this.aiResponseInProgress=!1,this.hybridThreshold=(null==n?void 0:n.hybridThreshold)||.3,n&&n.apiKey)try{void 0!==h?this.apiClient=new h(n):(console.error("[SWC] OpenRouterAPI class not found. Please include openrouter-client.js"),this.apiClient=null),void 0!==d?this.contextManager=new d({systemPrompt:n.systemPrompt||"You are a helpful assistant.",maxMessages:n.contextMaxMessages||10,maxTokens:n.contextMaxTokens||2e3,debug:n.debug||!1}):(console.error("[SWC] ContextManager class not found. Please include context-manager.js"),this.contextManager=null)}catch(t){console.error("[SWC] Error initializing API components:",t),this.apiClient=null,this.contextManager=null}else this.apiClient=null,this.contextManager=null},e=[{key:"init",value:function(){this.currentNode=this.knowledgeBase.find((function(t){return"welcome"===t.id}))||this.knowledgeBase[0];var t={reply:this.currentNode.reply,options:this.currentNode.options};return this.addToHistory("bot",this.currentNode.reply,this.currentNode.id,this.currentNode.options),t}},{key:"addToHistory",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"keyword",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a={id:"msg-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),timestamp:(new Date).toISOString(),type:t,content:e,source:o};"bot"===t&&(a.nodeId=r,n&&n.length>0&&(a.options=n),i&&(a.model=i.model)),this.chatHistory.push(a)}},{key:"handleInput",value:(n=c(o().mark((function t(e){var r,n,a,s,c,l,u,h,d=this,p=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=p.length>1&&void 0!==p[1]?p[1]:{},n=e.toLowerCase(),a=n.split(/\s+/),this.addToHistory("user",e),this.contextManager&&this.contextManager.addMessage("user",e),s={},this.knowledgeBase.forEach((function(t){s[t.id]=0,t.keyword.forEach((function(e){var r=e.toLowerCase();a.forEach((function(e){(e.includes(r)||r.includes(e))&&s[t.id]++}))}))})),c=null,l=0,Object.entries(s).forEach((function(t){var e=i(t,2),r=e[0],n=e[1];n>l&&(l=n,c=d.knowledgeBase.find((function(t){return t.id===r})))})),u=0,l>0&&(u=Math.min(.5+.1*(l-1),1)),"hybrid"===this.mode&&console.log("[SWC Hybrid Debug]",{input:e,bestMatch:c?c.id:null,maxScore:l,confidence:u,threshold:this.hybridThreshold,willUseAI:!c||u<this.hybridThreshold}),"ai-only"!==this.mode||!this.apiClient){t.next=19;break}return t.next=16,this.handleAIResponse(e,r);case 16:return t.abrupt("return",t.sent);case 19:if("hybrid"!==this.mode||!this.apiClient){t.next=26;break}if(c&&!(u<this.hybridThreshold)){t.next=24;break}return t.next=23,this.handleAIResponse(e,r);case 23:return t.abrupt("return",t.sent);case 24:t.next=27;break;case 26:"keyword-only"===this.mode||this.apiClient;case 27:if(!c){t.next=34;break}return this.currentNode=c,this.addToHistory("bot",c.reply,c.id,c.options,"keyword"),this.contextManager&&this.contextManager.addMessage("assistant",c.reply),t.abrupt("return",{reply:c.reply,options:c.options,source:"keyword",confidence:u});case 34:if("hybrid"!==this.mode||!this.apiClient){t.next=38;break}return t.next=37,this.handleAIResponse(e,r);case 37:return t.abrupt("return",t.sent);case 38:return h="I'm sorry, I didn't understand that. Can you please rephrase?",this.addToHistory("bot",h,null,null,"fallback"),t.abrupt("return",{reply:h,options:null,source:"fallback"});case 41:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"handleAIResponse",value:(r=c(o().mark((function t(e){var r,n,i,a,s=this,c=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:{},this.apiClient){t.next=4;break}return console.error("[SWC] API client not initialized"),t.abrupt("return",{reply:"AI features are not configured properly.",options:null,source:"error"});case 4:if(!this.aiResponseInProgress){t.next=7;break}return console.warn("[SWC] AI response already in progress"),t.abrupt("return",{reply:"Please wait for the current response to complete.",options:null,source:"error"});case 7:return this.aiResponseInProgress=!0,t.prev=8,n=this.contextManager.getContext(!0),r.onStart&&r.onStart(),t.next=14,this.apiClient.sendMessage(n,(function(t){t.fullContent,r.onChunk&&r.onChunk(t)}),(function(t){var e=s.apiClient.getModelInfo();s.addToHistory("bot",t.content,null,null,"api",e),s.contextManager&&s.contextManager.addMessage("assistant",t.content),r.onComplete&&r.onComplete(t)}),(function(t){console.error("[SWC] AI response error:",t),r.onError&&r.onError(t)}));case 14:return i=t.sent,this.aiResponseInProgress=!1,t.abrupt("return",{reply:i.content,options:null,source:"api",model:i.model});case 19:return t.prev=19,t.t0=t.catch(8),this.aiResponseInProgress=!1,console.error("[SWC] Error in handleAIResponse:",t.t0),a=this._getErrorMessage(t.t0),this.addToHistory("bot",a,null,null,"error"),r.onError&&r.onError(t.t0),t.abrupt("return",{reply:a,options:null,source:"error"});case 27:case"end":return t.stop()}}),t,this,[[8,19]])}))),function(t){return r.apply(this,arguments)})},{key:"cancelAIResponse",value:function(){return!(!this.apiClient||!this.aiResponseInProgress||(this.apiClient.cancel(),this.aiResponseInProgress=!1,0))}},{key:"_getErrorMessage",value:function(t){return t.message.includes("Invalid API key")?"⚠️ API authentication failed. Please check your API key configuration.":t.message.includes("Rate limit")?"⚠️ Too many requests. Please wait a moment and try again.":t.message.includes("cancelled")?"Response cancelled.":t.message.includes("service is temporarily unavailable")?"⚠️ The AI service is temporarily unavailable. Please try again later.":"⚠️ An error occurred: ".concat(t.message)}},{key:"_enhancePromptWithKnowledge",value:function(t){var e=[],r=t.toLowerCase();if(this.knowledgeBase.forEach((function(t){t.keyword.forEach((function(n){r.includes(n.toLowerCase())&&e.push(t)}))})),e.length>0){var n=e.map((function(t){return"Topic: ".concat(t.id,"\nInformation: ").concat(t.reply)})).join("\n\n");this.contextManager.injectKnowledge(n)}}},{key:"getAPIStatus",value:function(){return{enabled:!!this.apiClient,mode:this.mode,streaming:this.streamingEnabled,model:this.apiClient?this.apiClient.getModelInfo():null,contextStats:this.contextManager?this.contextManager.getStats():null,responseInProgress:this.aiResponseInProgress}}},{key:"handleOptionSelection",value:function(t){var e=this.knowledgeBase.find((function(e){return e.id===t}));if(e)return this.currentNode=e,this.addToHistory("bot",e.reply,e.id,e.options),{reply:e.reply,options:e.options};var r="I'm sorry, I couldn't find the appropriate response. How else can I assist you?";return this.addToHistory("bot",r,null,null),{reply:r,options:null}}},{key:"exportHistory",value:function(){var t={version:"2.0",timestamp:(new Date).toISOString(),botName:this.botMetadata.botName,themeColor:this.botMetadata.themeColor,messages:this.chatHistory,currentNodeId:this.currentNode?this.currentNode.id:null,mode:this.mode,apiEnabled:!!this.apiClient,apiConfig:this.apiClient?{model:this.apiClient.model,lastUsed:(new Date).toISOString()}:null};return JSON.stringify(t,null,2)}},{key:"getCurrentState",value:function(){return{currentNodeId:this.currentNode?this.currentNode.id:null,messageCount:this.chatHistory.length,lastMessageTimestamp:this.chatHistory.length>0?this.chatHistory[this.chatHistory.length-1].timestamp:null}}},{key:"loadHistory",value:function(t){var e=this;try{var r="string"==typeof t?JSON.parse(t):t;if(!r.version||!r.messages||!Array.isArray(r.messages))throw new Error("Invalid history format: missing required fields");if(r.version.startsWith("1.")||r.version.startsWith("2.")||console.warn("History version ".concat(r.version," may not be fully compatible")),r.botName&&(this.botMetadata.botName=r.botName),r.themeColor&&(this.botMetadata.themeColor=r.themeColor),this.chatHistory=r.messages,r.currentNodeId){var n=this.knowledgeBase.find((function(t){return t.id===r.currentNodeId}));n&&(this.currentNode=n)}return this.contextManager&&r.messages&&(this.contextManager.clear(),r.messages.forEach((function(t){"user"===t.type?e.contextManager.addMessage("user",t.content):"bot"===t.type&&e.contextManager.addMessage("assistant",t.content)}))),{success:!0,messageCount:this.chatHistory.length,messages:this.chatHistory}}catch(t){return console.error("Error loading history:",t),{success:!1,error:t.message,messages:[]}}}},{key:"clearHistory",value:function(){return this.chatHistory=[],this.currentNode=this.knowledgeBase.find((function(t){return"welcome"===t.id}))||this.knowledgeBase[0],this.currentNode&&this.addToHistory("bot",this.currentNode.reply,this.currentNode.id,this.currentNode.options),{reply:this.currentNode?this.currentNode.reply:"",options:this.currentNode?this.currentNode.options:null}}},{key:"getHistory",value:function(){return{version:"2.0",timestamp:(new Date).toISOString(),botName:this.botMetadata.botName,themeColor:this.botMetadata.themeColor,messages:this.chatHistory,currentNodeId:this.currentNode?this.currentNode.id:null,mode:this.mode,apiEnabled:!!this.apiClient}}}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}(),f=[{id:"welcome",keyword:["hello","hi","hey"],reply:'Welcome! How can I assist you <b>today?</b> <a href="https://senangwebs.com">senangwebs.com</a>',options:[{label:"Get Help",reply_id:"help"},{label:"End Chat",reply_id:"goodbye"}]},{id:"help",keyword:["help","support","assist"],reply:"Sure, I can help! What do you need assistance with?",options:[{label:"Product Information",reply_id:"product"},{label:"Billing",reply_id:"billing"},{label:"Technical Support",reply_id:"tech_support"}]},{id:"product",keyword:["product","information"],reply:"Our product is designed to make your life easier. Would you like to know more about its features or pricing?",options:[{label:"Features",reply_id:"features"},{label:"Pricing",reply_id:"pricing"}]},{id:"billing",keyword:["billing","payment","invoice"],reply:"For billing inquiries, please visit our billing portal or contact our finance department at billing@example.com.",options:[{label:"Back to Help",reply_id:"help"},{label:"End Chat",reply_id:"goodbye"}]},{id:"tech_support",keyword:["technical","support","issue"],reply:"For technical support, please describe your issue in detail and well do our best to assist you."},{id:"features",keyword:["features","functionality"],reply:"Our product offers cutting-edge features including AI-powered analytics, real-time collaboration, and seamless integration with popular tools.",options:[{label:"Back to Product Info",reply_id:"product"},{label:"End Chat",reply_id:"goodbye"}]},{id:"pricing",keyword:["pricing","cost","plans"],reply:"We offer flexible pricing plans starting at $9.99/month. For detailed pricing information, please visit our website or contact our sales team.",options:[{label:"Back to Product Info",reply_id:"product"},{label:"End Chat",reply_id:"goodbye"}]},{id:"goodbye",keyword:["bye","goodbye","end"],reply:"Thank you for chatting with us. Have a great day!",options:[{label:"Restart Chat",reply_id:"welcome"}]}];function y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;document.querySelectorAll("[data-swc]").forEach((function(e){var r=e.getAttribute("data-swc-theme-color")||"#007bff",n=e.getAttribute("data-swc-bot-name")||"Bot",i=e.getAttribute("data-swc-chat-display")||"classic",a=parseInt(e.getAttribute("data-swc-reply-duration"))||0,s=e.getAttribute("data-swc-load"),l=e.getAttribute("data-swc-api-mode"),u=e.getAttribute("data-swc-api-key"),h=e.getAttribute("data-swc-api-model"),d=e.getAttribute("data-swc-api-streaming"),y=e.getAttribute("data-swc-api-max-tokens"),m=e.getAttribute("data-swc-api-temperature"),g=e.getAttribute("data-swc-system-prompt"),v=e.getAttribute("data-swc-context-max-messages"),b=e.getAttribute("data-swc-api-base-url"),w=e.getAttribute("data-swc-hybrid-threshold"),x=null;u&&"keyword-only"!==l&&(x={apiKey:u,mode:l||"hybrid",model:h||"openai/gpt-3.5-turbo",streaming:"false"!==d,maxTokens:parseInt(y)||500,temperature:parseFloat(m)||.7,systemPrompt:g||"You are a helpful assistant.",contextMaxMessages:parseInt(v)||10,baseURL:b,hybridThreshold:parseFloat(w)||.7,siteName:n,siteUrl:window.location.origin},b&&!b.includes("openrouter.ai")||console.warn("[SWC] ⚠️ API key is exposed in client-side code. For production, use a server-side proxy."));var k=new p(t||f,{botName:n,themeColor:r},x);e.chatbotInstance=k;var E=function(t,e,r,n){var o=document.createElement("div");o.className="swc-chat-display ".concat("modern"===n?"swc-modern":"swc-classic");var i=document.createElement("div");i.className="swc-input-container";var a=document.createElement("input");a.type="text",a.className="swc-user-input",a.placeholder="Type your message...";var s=document.createElement("button");s.className="swc-send-button",s.textContent="Send";var c=document.createElement("div");c.className="swc-options-container",i.appendChild(a),i.appendChild(s);var l=document.createElement("div");return l.className="swc-typing-indicator",l.innerHTML="<span></span><span></span><span></span>",t.appendChild(o),t.appendChild(c),t.appendChild(i),t.style.setProperty("--swc-theme-color",e),t.style.setProperty("--swc-bot-name",'"'.concat(r,'"')),{chatDisplay:o,userInput:a,sendButton:s,optionsContainer:c,typingIndicator:l,inputContainer:i}}(e,r,n,i),C=E.chatDisplay,S=E.userInput,I=E.sendButton,P=E.optionsContainer,T=E.typingIndicator,A=E.inputContainer;function M(){C.innerHTML="",P.innerHTML="",P.style.display="none"}function L(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"keyword";W();var o=document.createElement("div");return o.className="swc-message swc-bot-message ".concat(r?"swc-streaming":""," ").concat("api"===n?"swc-ai-message":""),o.innerHTML="".concat(t),o.setAttribute("data-message-id","msg-".concat(Date.now())),C.appendChild(o),B(C),P.innerHTML="",e&&e.length>0?(P.style.display="flex",e.forEach((function(t){var e=document.createElement("button");e.textContent=t.label,e.onclick=function(){return _(t.reply_id)},P.appendChild(e)}))):P.style.display="none",o}function O(){return N.apply(this,arguments)}function N(){return(N=c(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=S.value.trim())&&((r=document.createElement("div")).className="swc-message swc-user-message",r.innerHTML="".concat(e),C.appendChild(r),B(C),S.value="",j(),H(),"keyword-only"!==k.mode&&k.apiClient&&0===a?setTimeout(c(o().mark((function t(){var r,n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return W(),r=null,n=null,t.next=5,k.handleInput(e,{onStart:function(){var t;r=L("",null,!0,"api"),k.streamingEnabled&&((t=document.createElement("button")).className="swc-stop-button",t.innerHTML="⏹ Stop",t.onclick=function(){k.cancelAIResponse(),t.remove(),R()},n=t,A.insertBefore(n,A.firstChild))},onChunk:function(t){r&&(r.innerHTML=t.fullContent,B(C))},onComplete:function(t){r&&r.classList.remove("swc-streaming"),n&&n.remove(),R()},onError:function(t){n&&n.remove(),r&&(r.classList.remove("swc-streaming"),r.classList.add("swc-error-message")),R()}});case 5:i=t.sent,r||(L(i.reply,i.options,!1,i.source),R());case 7:case"end":return t.stop()}}),t)}))),500):setTimeout(c(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k.handleInput(e);case 2:L((r=t.sent).reply,r.options,!1,r.source),R();case 5:case"end":return t.stop()}}),t)}))),a));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(t){j(),H(),setTimeout((function(){var e=k.handleOptionSelection(t);L(e.reply,e.options),R()}),a)}function j(){S.disabled=!0,I.disabled=!0}function R(){S.disabled=!1,I.disabled=!1}function H(){W(),C.appendChild(T),B(C)}function W(){T.parentNode===C&&C.removeChild(T)}function B(t){var e=t.scrollHeight-t.clientHeight,r=t.scrollTop,n=e-r,o=null;window.requestAnimationFrame((function e(i){o||(o=i);var a,s,c,l=i-o;t.scrollTop=(a=l,s=r,c=n,(a/=150)<1?c/2*a*a*a+s:c/2*((a-=2)*a*a+2)+s),l<300&&window.requestAnimationFrame(e)}))}I.addEventListener("click",O),S.addEventListener("keypress",(function(t){"Enter"===t.key&&O()}));var D=k.clearHistory.bind(k);k.clearHistory=function(){var t=D();return M(),L(t.reply,t.options),e.dispatchEvent(new CustomEvent("swc:history-cleared",{detail:{timestamp:(new Date).toISOString()}})),t};var F=k.exportHistory.bind(k);k.exportHistory=function(){var t=F();return e.dispatchEvent(new CustomEvent("swc:history-exported",{detail:{messageCount:k.chatHistory.length,historyJSON:t,timestamp:(new Date).toISOString()}})),t};var G=k.loadHistory.bind(k);if(k.loadHistory=function(t){var r=G(t);if(r.success){if(M(),r.messages.forEach((function(t){var e,r;e=t,(r=document.createElement("div")).className="swc-message swc-".concat(e.type,"-message"),r.innerHTML=e.content,C.appendChild(r)})),r.messages.length>0){var n=r.messages[r.messages.length-1];n.options&&n.options.length>0&&(P.style.display="flex",n.options.forEach((function(t){var e=document.createElement("button");e.textContent=t.label,e.onclick=function(){return _(t.reply_id)},P.appendChild(e)})))}B(C),e.dispatchEvent(new CustomEvent("swc:history-loaded",{detail:{messageCount:r.messageCount,timestamp:(new Date).toISOString()}}))}else console.error("Failed to load history:",r.error);return r},s)if(s.startsWith("http://")||s.startsWith("https://")||s.startsWith("./")||s.startsWith("../")||s.endsWith(".json"))fetch(s).then((function(t){if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return t.json()})).then((function(t){k.loadHistory(t)})).catch((function(t){console.error("Error loading history from file:",t);var e=k.init();L(e.reply,e.options)}));else try{var U=JSON.parse(s);k.loadHistory(U)}catch(t){console.error("Error parsing inline history JSON:",t);var q=k.init();L(q.reply,q.options)}else{var K=k.init();L(K.reply,K.options)}}))}"undefined"!=typeof window&&(window.initializeChatbot=y,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){y()})):y())},542:(t,e,r)=>{"use strict";r.r(e)}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}return r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(74),r(708),r(982),r(542)})()));